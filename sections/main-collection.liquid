<section class="wf-section">
  <div class="wf-wrap">
    <div class="wf-section__head">
      <h1 class="wf-section__title">{{ collection.title }}</h1>
    </div>

    <div class="wf-grid wf-product-grid">
      {% for product in collection.products %}
        <a class="wf-product-card" href="{{ product.url }}">
          <div class="wf-product-card__media">
            {% if product.featured_image %}
              <img
                class="wf-product-card__img"
                src="{{ product.featured_image | image_url: width: 720 }}"
                alt="{{ product.featured_image.alt | default: product.title | escape }}"
                loading="lazy">
            {% else %}
              <div class="wf-product-card__img wf-product-card__img--placeholder" aria-hidden="true">No Image</div>
            {% endif %}
            <span class="wf-product-card__price">{{ product.price | money }}</span>
          </div>
          <div class="wf-product-card__content">
            <h3>{{ product.title }}</h3>
            {% assign meta_list = '' %}
            {% assign meta_count = 0 %}
            {% for rel_collection in product.collections %}
              {% if rel_collection.handle != collection.handle %}
                {% assign meta_count = meta_count | plus: 1 %}
                {% if meta_count <= 2 %}
                  {% if meta_list != blank %}
                    {% assign meta_list = meta_list | append: ', ' %}
                  {% endif %}
                  {% assign meta_list = meta_list | append: rel_collection.title %}
                {% endif %}
              {% endif %}
            {% endfor %}
            {% if meta_count == 0 and product.tags.size > 0 %}
              {% assign meta_list = '' %}
              {% assign meta_count = 0 %}
              {% for tag in product.tags %}
                {% assign meta_count = meta_count | plus: 1 %}
                {% if meta_count <= 2 %}
                  {% if meta_list != blank %}
                    {% assign meta_list = meta_list | append: ', ' %}
                  {% endif %}
                  {% assign meta_list = meta_list | append: tag %}
                {% endif %}
              {% endfor %}
            {% endif %}
            <span class="wf-product-card__meta">
              {% if meta_list != blank %}
                {{ meta_list }}{% if meta_count > 2 %} + {{ meta_count | minus: 2 }} more{% endif %}
              {% else %}
                Foundational wellness support
              {% endif %}
            </span>
            {% assign rating_value = product.metafields.reviews.rating.value.rating | default: product.metafields.reviews.rating.value | default: 0 %}
            {% assign rating_scaled = rating_value | times: 1.0 %}
            {% assign rating_stars = rating_scaled | round %}
            {% if rating_stars < 0 %}{% assign rating_stars = 0 %}{% endif %}
            {% if rating_stars > 5 %}{% assign rating_stars = 5 %}{% endif %}
            <span class="wf-product-card__rating">
              <span class="wf-product-card__stars" aria-hidden="true">
                {% for star in (1..5) %}
                  {% if star <= rating_stars %}★{% else %}☆{% endif %}
                {% endfor %}
              </span>
              ({{ rating_scaled | round: 1 }}/5)
            </span>
            <span class="wf-product-card__view">View &rarr;</span>
          </div>
        </a>
      {% endfor %}
    </div>
  </div>
</section>
{% schema %}{ "name": "Main collection", "settings": [] }{% endschema %}
